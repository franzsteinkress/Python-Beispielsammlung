<!-- Copyright (c) 2025 Franz Steinkress
     Licensed under the MIT License - see LICENSE for details -->

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Simulator</title>
    <link href="{{ url_for('static', filename='css/theme.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1><img src="{{ url_for('static', filename='icons/fs.ico') }}" alt="Chatbot Icon">Chatbot Simulator</h1>
        <div id="chat-history">
            {% for msg in session.get('chat_history', []) %}
                <p><strong>User:</strong> {{ msg.user }}</p>
                <p><strong>Bot:</strong> {{ msg.bot }}</p>
            {% endfor %}
        </div>
        <!-- Simulation eines Chatverlaufs für Screenshots -->
        <!--<div id="chat-history">
            <style>
                #chat-history div:nth-child(even) {
                    margin: 5px 0;
                    text-align: left;
                    color: #000000;
                }
                #chat-history div:nth-child(odd) {
                    margin: 5px 0;
                    text-align: right;
                    color: #007bff;
                }
            </style>
            <div><strong>User:</strong> Hallo</div>
            <div><strong>Bot:</strong> Hallo! Wie kann ich dir helfen?</div>
            <div><strong>User:</strong> Hilfe</div>
            <div><strong>Bot:</strong> Ich bin hier, um zu antworten. Was möchtest du wissen?</div>
            <div><strong>User:</strong> Nichts</div>
            <div><strong>Bot:</strong> Antwort: Du hast 'nichts' gesagt!</div>
            <div><strong>User:</strong> Was bist Du?</div>
            <div><strong>Bot:</strong> Antwort: Du hast 'was bist du?' gesagt!</div>
            <div><strong>User:</strong> Wo bist Du?</div>
            <div><strong>Bot:</strong> Antwort: Du hast 'wo bist du?' gesagt!</div>
            <div><strong>User:</strong> Bye</div>
            <div><strong>Bot:</strong> Tschüss, bis bald!</div>
        </div>-->
        <div id="chatbox">
            <div id="input-container">
                <input type="text" id="user-input" placeholder="Deine Nachricht..." onkeypress="if(event.key === 'Enter') sendMessage();">
                <button onclick="sendMessage()">Senden</button>
            </div>
            <button id="clear-history-btn" onclick="clearHistory()">Historie löschen</button>
        </div>
    </div>
    <script>
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function sendMessage() {
            const input = document.getElementById("user-input").value.trim();
            if (input) {
                const escapedInput = escapeHtml(input);
                fetch(`/get?msg=${encodeURIComponent(input)}`)
                    .then(response => response.text())
                    .then(data => {
                        const chatHistory = document.getElementById("chat-history");
                        chatHistory.innerHTML += `<p><strong>User:</strong> ${escapedInput}</p>`;
                        chatHistory.innerHTML += `<p><strong>Bot:</strong> ${data}</p>`;
                        document.getElementById("user-input").value = "";
                        chatHistory.scrollTop = chatHistory.scrollHeight;
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                alert("Bitte gib eine Nachricht ein!");
            }
        }

        function clearHistory() {
            // Zu viele Abfragen beim Löschen stören!
            //if (confirm("Möchtest du die Chat-Historie wirklich löschen?")) {
                fetch('/clear')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById("chat-history").innerHTML = "";
                        //alert(data);
                    })
                    .catch(error => console.error('Error:', error));
            //}
        }
    </script>
</body>
</html>